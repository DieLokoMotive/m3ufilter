language: go

go:
  - "1.12"

services:
  - docker

git:
  depth: 1

env:
  global:
    - GO111MODULE=on
    - CGO_ENABLED=0

before_script:
  - mkdir -p build
  - go get github.com/mitchellh/gox
  - diff -u <(echo -n) <(gofmt -d .)
  - go mod vendor
  - go vet $(go list ./... | grep -v /vendor/)
  - go test -v ./... # todo we don't actually have any tests yet, but soon!

script:
  - gox -osarch "linux/amd64 linux/386 windows/amd64 windows/386 darwin/amd64 darwin/386" -output "build/m3u-filter_{{.OS}}_{{.Arch}}" github.com/hoshsadiq/m3ufilter/cmd/m3u-filter

after_script:
  - ls -la build/
